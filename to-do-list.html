<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced To-Do List</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #111;
            color: #f8f9fa;
        }
        .container {
            margin-top: 30px;
        }
        .btn-primary, .btn-success, .btn-danger {
            background-color: #d10000;
            border-color: #d10000;
        }
        .btn-primary:hover, .btn-success:hover, .btn-danger:hover {
            background-color: #ffcc00;
            border-color: #ffcc00;
        }
        .task-done {
            text-decoration: line-through;
            color: #777;
        }
        .progress-bar {
            background-color: #ffcc00;
        }
        .history-item {
            color: #d10000;
        }
        .subtask-item {
            margin-left: 20px;
        }
        .fadeIn {
            animation: fadeIn 0.5s ease-in;
        }
        .fadeOut {
            animation: fadeOut 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center mb-4" style="color:#ffcc00;">Advanced To-Do List</h1>

    <!-- Progress Bar -->
    <div class="progress mb-4">
        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
    </div>

    <!-- Input form to add new tasks -->
    <div class="input-group mb-3">
        <input id="new-task" type="text" class="form-control" placeholder="Add a new task" aria-label="Add a new task">
        <div class="input-group-append">
            <button class="btn btn-primary" type="button" onclick="addTask()">Add Task</button>
        </div>
    </div>

    <!-- To-Do List -->
    <ul id="task-list" class="list-group mb-4">
        <!-- Tasks will be dynamically added here -->
    </ul>

    <!-- History -->
    <h5>Action History</h5>
    <ul id="history-list" class="list-group">
        <!-- History of actions will be logged here -->
    </ul>
</div>

<!-- Bootstrap JS and jQuery (needed for Bootstrap JS components) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    let taskCounter = 0;
    let history = [];

    // Function to add a new task
    function addTask() {
        const taskInput = document.getElementById("new-task");
        const taskText = taskInput.value;

        if (taskText === "") {
            alert("Please enter a task.");
            return;
        }

        // Create a unique ID for the task
        const taskId = `task-${taskCounter++}`;

        // Create a new list item for the task with subtasks and progress tracking
        const listItem = document.createElement("li");
        listItem.className = "list-group-item fadeIn";
        listItem.id = taskId;

        // Add the task text, a progress bar for subtasks, and buttons for actions
        listItem.innerHTML = `
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="task-title">${taskText}</span>
                    <div class="progress mt-2">
                        <div id="progress-bar-${taskId}" class="progress-bar" role="progressbar" style="width: 0%;"></div>
                    </div>
                </div>
                <div>
                    <button class="btn btn-success btn-sm" onclick="addSubtask('${taskId}')">Add Subtask</button>
                    <button class="btn btn-success btn-sm" onclick="markDone('${taskId}')">Done</button>
                    <button class="btn btn-danger btn-sm" onclick="removeTask('${taskId}')">Delete</button>
                </div>
            </div>
            <ul id="subtask-list-${taskId}" class="list-group mt-2"></ul>
        `;
        
        // Add the new task to the task list
        document.getElementById("task-list").appendChild(listItem);
        
        // Log history
        logHistory(`Added task: "${taskText}"`);

        // Clear the input field
        taskInput.value = "";

        updateProgress();
    }

    // Function to add a subtask to a task
    function addSubtask(taskId) {
        const subtaskText = prompt("Enter subtask:");
        if (!subtaskText) return;

        const subtaskList = document.getElementById(`subtask-list-${taskId}`);
        const subtaskItem = document.createElement("li");
        subtaskItem.className = "list-group-item subtask-item fadeIn";

        subtaskItem.innerHTML = `
            <span>${subtaskText}</span>
            <button class="btn btn-success btn-sm float-right" onclick="markSubtaskDone(this, '${taskId}')">Done</button>
        `;

        subtaskList.appendChild(subtaskItem);

        logHistory(`Added subtask: "${subtaskText}" to task: "${taskId}"`);
        updateProgress();
    }

    // Function to mark a task as done
    function markDone(taskId) {
        const taskItem = document.getElementById(taskId);
        taskItem.querySelector(".task-title").classList.toggle("task-done");
        logHistory(`Marked task as done: "${taskItem.querySelector('.task-title').textContent}"`);
    }

    // Function to mark a subtask as done
    function markSubtaskDone(button, taskId) {
        const subtaskItem = button.parentElement;
        subtaskItem.querySelector("span").classList.toggle("task-done");
        button.remove(); // Remove the "Done" button after completion

        logHistory(`Marked subtask as done: "${subtaskItem.querySelector('span').textContent}"`);
        updateProgress();
    }

    // Function to remove a task
    function removeTask(taskId) {
        const taskItem = document.getElementById(taskId);
        taskItem.classList.add("fadeOut");
        
        setTimeout(() => taskItem.remove(), 500); // Delay for fade-out animation

        logHistory(`Deleted task: "${taskItem.querySelector('.task-title').textContent}"`);
        updateProgress();
    }

    // Function to log history of actions
    function logHistory(action) {
        const historyList = document.getElementById("history-list");
        const historyItem = document.createElement("li");
        historyItem.className = "list-group-item history-item fadeIn";
        historyItem.textContent = action;
        historyList.appendChild(historyItem);
    }

    // Function to update the progress bar based on completed subtasks
    function updateProgress() {
        const taskList = document.getElementById("task-list").children;
        let totalSubtasks = 0;
        let completedSubtasks = 0;

        Array.from(taskList).forEach(task => {
            const subtasks = task.querySelectorAll(".subtask-item");
            const doneSubtasks = task.querySelectorAll(".subtask-item .task-done");

            totalSubtasks += subtasks.length;
            completedSubtasks += doneSubtasks.length;

            // Update progress bar for the task
            const taskProgress = task.querySelector(`.progress-bar`);
            const taskProgressPercentage = subtasks.length > 0 ? (doneSubtasks.length / subtasks.length) * 100 : 0;
            taskProgress.style.width = `${taskProgressPercentage}%`;
        });

        // Update the main progress bar
        const overallProgress = totalSubtasks > 0 ? (completedSubtasks / totalSubtasks) * 100 : 0;
        document.getElementById("progress-bar").style.width = `${overallProgress}%`;
    }
</script>

</body>
</html>

