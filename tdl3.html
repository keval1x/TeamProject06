<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>To Do List</title>
  <link
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    .container-fluid {
      padding: 0;
    }

    .design-bar button,
    .design-bar input[type="color"] {
      margin-right: 5px;
      border-radius: 5px;
      padding: 5px 10px;
      border: 1px solid #ccc;
    }

    .design-bar input[type="color"] {
      padding: 0;
      width: 40px;
      height: 38px;
      border: none;
    }

    .design-bar button {
      background-color: #007bff;
      color: #fff;
    }

    .btn {
      border-radius: 5px;
    }

    .task-bar,
    .subtask-bar {
      background-color: #f8f9fa;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .task-bar {
      width: 100%;
    }

    .subtask-bar {
      width: 90%;
      margin-left: 10%;
    }

    .task-content,
    .subtask-content {
      width: 100%;
      min-height: 50px;
      font-size: 16px;
      border: none;
      background: transparent;
      outline: none;
    }

    .task-content[placeholder]:empty:before,
    .subtask-content[placeholder]:empty:before {
      content: attr(placeholder);
      color: #999;
    }

    .task-content,
    .subtask-content {
      resize: none;
      overflow: hidden;
    }

    .progress {
      margin-bottom: 10px;
    }

    .status-label {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .status-label.complete {
      background-color: #28a745;
      color: #fff;
    }

    .status-label.uncomplete {
      background-color: #dc3545;
      color: #fff;
    }

    .dark-mode {
      background-color: #333 !important;
      color: #fff !important;
    }

    .dark-mode .task-bar,
    .dark-mode .subtask-bar {
      background-color: #444;
      border-color: #555;
    }

    .dark-mode .list-group-item {
      background-color: #333;
      color: #fff;
    }

    .list-group-item.active {
      background-color: #007bff;
      border-color: #007bff;
    }

    .list-group-item {
      border: none;
      border-radius: 0;
    }

    .list-group-item:not(:last-child) {
      border-bottom: 1px solid #ccc;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <!-- Progress Bar -->
    <div id="progressContainer" class="row">
      <div class="col">
        <div class="progress">
          <div
            id="progressBar"
            class="progress-bar"
            role="progressbar"
            style="width: 0%"
          ></div>
        </div>
      </div>
    </div>
    <!-- Sidebar -->
    <div class="row">
      <div class="col-md-2">
        <ul class="list-group">
          <li
            class="list-group-item active"
            data-section="todoContent"
            id="todoButton"
          >
            To Do List
          </li>
          <li
            class="list-group-item"
            data-section="historyContent"
            id="historyButton"
          >
            History
          </li>
          <li
            class="list-group-item"
            data-section="designContent"
            id="designButton"
          >
            Design
          </li>
        </ul>
      </div>
      <div class="col-md-10">
        <!-- Formatting -->
        <div class="design-bar mb-2">
          <button id="boldBtn" onmousedown="event.preventDefault()">Bold</button>
          <button id="italicBtn" onmousedown="event.preventDefault()">Italic</button>
          <input
            type="color"
            id="color-picker"
            title="Choose Color"
          />
        </div>
        <!-- Add Task-->
        <button id="add-task-btn" class="btn btn-primary mb-2">Add Task</button>
        <div id="contentArea">
          <!-- To Do Content -->
          <div id="todoContent" class="section active">
            <div id="todo-list"></div>
          </div>
          <!-- History-->
          <div id="historyContent" class="section">
            <h3>History</h3>
            <div id="historyList"></div>
          </div>
          <!-- Design -->
          <div id="designContent" class="section">
            <h3>Design Settings</h3>
            <div class="form-group">
              <label for="colorScheme">Color Scheme:</label>
              <select id="colorScheme" class="form-control">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>
            <div class="form-group">
              <label for="fontSelect">Font:</label>
              <select id="fontSelect" class="form-control">
                <option value="sans-serif">Sans-serif</option>
                <option value="serif">Serif</option>
                <option value="monospace">Monospace</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Code -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let taskCounter = 0;
      let totalTasks = 0;
      let completedTasks = 0;
      let history = [];
      let selectedColor = "#000000";
      let tasks = [];

      // Elements
      const boldBtn = document.getElementById("boldBtn");
      const italicBtn = document.getElementById("italicBtn");
      const colorPicker = document.getElementById("color-picker");
      const addTaskBtn = document.getElementById("add-task-btn");
      const todoList = document.getElementById("todo-list");
      const progressBar = document.getElementById("progressBar");
      const todoButton = document.getElementById("todoButton");
      const historyButton = document.getElementById("historyButton");
      const designButton = document.getElementById("designButton");
      const navLinks = document.querySelectorAll(".list-group-item");
      const sections = document.querySelectorAll(".section");
      const colorSchemeSelect = document.getElementById("colorScheme");
      const fontSelect = document.getElementById("fontSelect");
      const historyList = document.getElementById("historyList");

      // Event Listeners
      boldBtn.addEventListener("click", () => formatText("bold"));
      italicBtn.addEventListener("click", () => formatText("italic"));
      colorPicker.addEventListener("input", (event) =>
        changeTextColor(event.target.value)
      );
      addTaskBtn.addEventListener("click", addTask);

      // Navigation Event Listeners
      navLinks.forEach((link) => {
        link.addEventListener("click", function () {
          navLinks.forEach((item) => item.classList.remove("active"));
          this.classList.add("active");

          const target = this.getAttribute("data-section");
          sections.forEach((section) => {
            section.classList.remove("active");
            if (section.id === target) {
              section.classList.add("active");
            }
          });
        });
      });

      // Design Settings Event Listeners
      colorSchemeSelect.addEventListener("change", () => {
        changeColorScheme(colorSchemeSelect.value);
      });

      fontSelect.addEventListener("change", () => {
        document.body.style.fontFamily = fontSelect.value;
        logHistory(
          `Changed font to ${fontSelect.options[fontSelect.selectedIndex].text}`
        );
      });

      function autoResizeDiv(div) {
        div.style.height = "auto";
        div.style.height = div.scrollHeight + "px";
      }

      function addTask() {
        totalTasks++;
        let taskId = "task" + taskCounter++;
        let taskDiv = document.createElement("div");
        taskDiv.className = "task-bar";
        taskDiv.id = taskId;
        taskDiv.dataset.completed = "false";

        // Auto-generate the creation date
        const creationDate = new Date().toLocaleDateString();

        taskDiv.innerHTML = `
          <div contenteditable="true" class="task-content" placeholder="New Task"></div>
          <div>
              <label>Creation Date: </label><span>${creationDate}</span>
          </div>
          <div>
              <label>Due Date:</label>
              <input type="date" class="due-date" onchange="updateDueDate('${taskId}', this.value)">
          </div>
          <div class="text-right mt-2">
              <button class="btn btn-secondary edit-task-btn">Save</button>
              <button class="btn btn-success complete-task-btn">Complete</button>
              <button class="btn btn-danger delete-task-btn">Delete</button>
          </div>
      `;
        todoList.appendChild(taskDiv);

        let contentDiv = taskDiv.querySelector(".task-content");
        contentDiv.style.color = selectedColor;
        contentDiv.addEventListener("input", function () {
          autoResizeDiv(contentDiv);
        });
        contentDiv.focus();

        // Log creation with the creation date
        logHistory("Created task", `New Task (created on ${creationDate})`);

        // Event Listeners for Task Buttons
        const editBtn = taskDiv.querySelector(".edit-task-btn");
        const completeBtn = taskDiv.querySelector(".complete-task-btn");
        const deleteBtn = taskDiv.querySelector(".delete-task-btn");

        editBtn.addEventListener("click", () => editTask(taskId, editBtn));
        completeBtn.addEventListener("click", () => completeTask(taskId, completeBtn));
        deleteBtn.addEventListener("click", () => deleteTask(taskId));
      }

      function deleteTask(taskId) {
        let taskElement = document.getElementById(taskId);
        let taskName =
          taskElement.querySelector(".task-content").textContent ||
          "Unnamed Task";
        if (taskElement.dataset.completed === "true") {
          completedTasks--;
        }
        totalTasks--;
        taskElement.remove();
        updateProgress();
        logHistory("Deleted task", taskName);
      }

      function editTask(taskId, button) {
        let taskDiv = document.getElementById(taskId);
        let contentDiv = taskDiv.querySelector(".task-content");
        if (contentDiv.isContentEditable) {
          contentDiv.contentEditable = "false";
          button.textContent = "Edit";
          let taskName = contentDiv.textContent || "Unnamed Task";
          logHistory("Saved task", taskName);
        } else {
          contentDiv.contentEditable = "true";
          contentDiv.focus();
          document.execCommand("foreColor", false, selectedColor);
          button.textContent = "Save";
        }
      }

      function completeTask(taskId, button) {
        let taskElement = document.getElementById(taskId);
        let taskName =
          taskElement.querySelector(".task-content").textContent ||
          "Unnamed Task";
        if (taskElement.dataset.completed === "true") {
          completedTasks--;
          taskElement.dataset.completed = "false";
          taskElement.style.textDecoration = "none";
          button.textContent = "Complete";
          button.classList.remove("btn-danger");
          button.classList.add("btn-success");
          logHistory("Uncompleted task", taskName);
        } else {
          completedTasks++;
          taskElement.dataset.completed = "true";
          taskElement.style.textDecoration = "line-through";
          button.textContent = "Uncomplete";
          button.classList.remove("btn-success");
          button.classList.add("btn-danger");
          logHistory("Completed task", taskName);
        }
        updateProgress();
      }

      function updateProgress() {
        let progress =
          totalTasks === 0 ? 0 : (completedTasks / totalTasks) * 100;
        progressBar.style.width = progress + "%";
        progressBar.setAttribute("aria-valuenow", progress);
        progressBar.textContent = `${Math.round(progress)}%`;
      }

      function formatText(command, value = null) {
        document.execCommand(command, false, value);
      }

      function changeTextColor(color) {
        selectedColor = color;
        // Update the color of future text input
        document.designMode = "on";
        document.execCommand("foreColor", false, selectedColor);
        document.designMode = "off";
      }

      function changeColorScheme(scheme) {
        if (scheme === "dark") {
          document.body.classList.add("dark-mode");
        } else {
          document.body.classList.remove("dark-mode");
        }
        logHistory(`Changed color scheme to ${scheme}`);
      }

      function logHistory(action, name) {
        const timestamp = new Date().toLocaleString();
        history.unshift(`${timestamp} - ${action}: ${name}`);
        renderHistory();
      }

      function renderHistory() {
        historyList.innerHTML = "";
        history.forEach((entry) => {
          let p = document.createElement("p");
          p.textContent = entry;
          historyList.appendChild(p);
        });
      }

      // Update Due Date
      window.updateDueDate = function(taskId, dueDate) {
        let taskElement = document.getElementById(taskId);
        logHistory(
          "Updated due date",
          `Task: ${
            taskElement.querySelector(".task-content").textContent ||
            "Unnamed Task"
          }, Due: ${dueDate}`
        );
      };
    });
  </script>
</body>
</html>
